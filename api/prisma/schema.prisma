// ===== GENERATOR & DATASOURCE =====

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== ENUMS =====

enum user_role_enum {
  user
  admin
  super_admin
}

enum user_provider_enum {
  local
  google
}

enum profile_language_enum {
  ko
  en
}

enum content_enum {
  image
  video
}

// ===== MODELS =====

model User {
  // Primary Key
  id  Int                       @id @default(autoincrement()) @db.Integer

  // User Information
  email     String              @db.VarChar
  password  String?             @db.VarChar
  firstName String              @db.VarChar
  lastName  String              @db.VarChar
  oauthId   String?             @db.VarChar
  
  // User Settings
  role      user_role_enum      @default(user)
  provider  user_provider_enum  @default(local)
  lastLogin DateTime?           @db.Timestamp(6)
  
  // Timestamps (Common fields)
  createdAt DateTime            @default(now()) @db.Timestamp(6)
  updatedAt DateTime            @default(now()) @updatedAt @db.Timestamp(6)
  deletedAt DateTime?           @db.Timestamp(6)
  version   Int                     @default(1) @db.Integer

  // Relations
  profile   Profile?          

  @@unique([email, deletedAt])
  @@unique([oauthId, provider, deletedAt])
  @@map("user")
}

model Profile {
  // Primary Key
  id        Int                     @id @default(autoincrement()) @db.Integer

  // Profile Information
  nickname  String                  @db.VarChar
  avatarUrl String                  @db.VarChar
  bio       String?
  language  profile_language_enum?
  silhouettes  Silhouette[]

  // Timestamps (Common fields)
  createdAt DateTime                @default(now()) @db.Timestamp(6)
  updatedAt DateTime                @default(now()) @updatedAt @db.Timestamp(6)
  deletedAt DateTime?               @db.Timestamp(6)
  version   Int                     @default(1) @db.Integer

  // Relations
  userId    Int                    @unique @db.Integer
  user      User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  likes     SilhouetteLike[]  

  @@unique([nickname, deletedAt])
  @@map("profile")
}

model PendingUser {
  // Primary Key
  id               Int      @id @default(autoincrement()) @db.Integer
  
  // User Information
  email            String   @unique @db.VarChar
  password         String   @db.VarChar
  firstName        String   @db.VarChar
  lastName         String   @db.VarChar
  
  // Verification
  verificationCode String   @db.VarChar
  codeExpiresAt    DateTime @db.Timestamp(6)

  // Timestamps
  createdAt        DateTime @default(now()) @db.Timestamp(6)

  @@map("pending_user")
}

model Silhouette {
  // Primary Key
  id          Int       @id @default(autoincrement()) @db.Integer

  // Silhouette Information
  contentUrl       String    @db.VarChar
  type    content_enum?
  runningTime Float  @db.DoublePrecision() @default(15.0)

  profileId Int
  profile   Profile   @relation(fields: [profileId], references: [id])

  // Timestamps (Common fields)
  createdAt   DateTime  @default(now()) @db.Timestamp(6)
  updatedAt   DateTime  @default(now()) @updatedAt @db.Timestamp(6)
  deletedAt   DateTime? @db.Timestamp(6)

  likes       SilhouetteLike[]

  @@map("silhouette")
}

model SilhouetteLike {
  // Primary Key
  id           Int       @id @default(autoincrement()) @db.Integer

  profileId       Int
  profile         Profile      @relation(fields: [profileId], references: [id], onDelete: Cascade)

  silhouetteId Int
  silhouette   Silhouette @relation(fields: [silhouetteId], references: [id], onDelete: Cascade)

  // Timestamps (Common fields)
  createdAt    DateTime  @default(now()) @db.Timestamp(6)
  updatedAt    DateTime  @default(now()) @updatedAt @db.Timestamp(6)
  deletedAt    DateTime? @db.Timestamp(6)

  @@unique([profileId, silhouetteId])
  @@map("silhouette_like")
}